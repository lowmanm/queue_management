<div class="queue-config">
  <header class="page-header">
    <div class="header-content">
      <h1>Queue Configuration</h1>
      <p class="subtitle">Manage queue settings, routing, and SLAs</p>
    </div>
    <button class="btn-primary" (click)="openAddModal()">
      + Add Queue
    </button>
  </header>

  <!-- Queue Table -->
  <div class="queue-table-container">
    <table class="queue-table">
      <thead>
        <tr>
          <th>Status</th>
          <th>Queue Name</th>
          <th>Priority</th>
          <th>SLA Target</th>
          <th>Max Wait</th>
          <th>Routing</th>
          <th>Agents</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        @for (queue of queues$ | async; track queue.id) {
          <tr [class.inactive]="!queue.active">
            <td>
              <button
                class="status-toggle"
                [class.active]="queue.active"
                (click)="toggleQueueActive(queue)"
                [title]="queue.active ? 'Click to deactivate' : 'Click to activate'"
              >
                {{ queue.active ? 'Active' : 'Inactive' }}
              </button>
            </td>
            <td>
              <div class="queue-name-cell">
                <span class="queue-name">{{ queue.name }}</span>
                <span class="queue-description">{{ queue.description }}</span>
              </div>
            </td>
            <td>
              <span class="priority-badge" [attr.data-priority]="queue.priority">
                {{ getPriorityLabel(queue.priority) }}
              </span>
            </td>
            <td>{{ formatDuration(queue.slaTarget) }}</td>
            <td>{{ formatDuration(queue.maxWaitTime) }}</td>
            <td>{{ getRoutingLabel(queue.routingMode) }}</td>
            <td>{{ queue.assignedAgents }}</td>
            <td>
              <div class="actions">
                <button class="btn-icon" (click)="openEditModal(queue)" title="Edit">
                  ✎
                </button>
                <button class="btn-icon delete" (click)="deleteQueue(queue)" title="Delete">
                  ✕
                </button>
              </div>
            </td>
          </tr>
        } @empty {
          <tr>
            <td colspan="8" class="empty-state">
              No queues configured. Click "Add Queue" to create one.
            </td>
          </tr>
        }
      </tbody>
    </table>
  </div>
</div>

<!-- Edit/Add Modal -->
@if (showModal && selectedQueue) {
  <div class="modal-overlay" (click)="closeModal()">
    <div class="modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>{{ isEditing ? 'Edit Queue' : 'Add New Queue' }}</h2>
        <button class="modal-close" (click)="closeModal()">×</button>
      </div>

      <div class="modal-body">
        <div class="form-group">
          <label for="queueName">Queue Name *</label>
          <input
            type="text"
            id="queueName"
            [(ngModel)]="selectedQueue.name"
            placeholder="Enter queue name"
          />
        </div>

        <div class="form-group">
          <label for="queueDescription">Description</label>
          <textarea
            id="queueDescription"
            [(ngModel)]="selectedQueue.description"
            placeholder="Enter queue description"
            rows="2"
          ></textarea>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="priority">Priority</label>
            <select id="priority" [(ngModel)]="selectedQueue.priority">
              <option [value]="1">Highest (1)</option>
              <option [value]="2">High (2)</option>
              <option [value]="3">Normal (3)</option>
              <option [value]="4">Low (4)</option>
              <option [value]="5">Lowest (5)</option>
            </select>
          </div>

          <div class="form-group">
            <label for="routingMode">Routing Mode</label>
            <select id="routingMode" [(ngModel)]="selectedQueue.routingMode">
              @for (mode of routingModes; track mode.value) {
                <option [value]="mode.value">{{ mode.label }}</option>
              }
            </select>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="slaTarget">SLA Target (seconds)</label>
            <input
              type="number"
              id="slaTarget"
              [(ngModel)]="selectedQueue.slaTarget"
              min="60"
              step="60"
            />
            <span class="input-hint">{{ formatDuration(selectedQueue.slaTarget) }}</span>
          </div>

          <div class="form-group">
            <label for="maxWaitTime">Max Wait Time (seconds)</label>
            <input
              type="number"
              id="maxWaitTime"
              [(ngModel)]="selectedQueue.maxWaitTime"
              min="60"
              step="60"
            />
            <span class="input-hint">{{ formatDuration(selectedQueue.maxWaitTime) }}</span>
          </div>
        </div>

        <div class="form-group">
          <label>Required Skills</label>
          <div class="chip-selector">
            @for (skill of availableSkills; track skill) {
              <button
                class="chip"
                [class.selected]="hasSkill(skill)"
                (click)="toggleSkill(skill)"
              >
                {{ skill }}
              </button>
            }
          </div>
        </div>

        <div class="form-group">
          <label>Work Types</label>
          <div class="chip-selector">
            @for (workType of availableWorkTypes; track workType) {
              <button
                class="chip"
                [class.selected]="hasWorkType(workType)"
                (click)="toggleWorkType(workType)"
              >
                {{ workType }}
              </button>
            }
          </div>
        </div>

        <div class="form-group">
          <label class="checkbox-label">
            <input type="checkbox" [(ngModel)]="selectedQueue.active" />
            <span>Queue is active</span>
          </label>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn-secondary" (click)="closeModal()">Cancel</button>
        <button
          class="btn-primary"
          (click)="saveQueue()"
          [disabled]="!selectedQueue.name"
        >
          {{ isEditing ? 'Save Changes' : 'Create Queue' }}
        </button>
      </div>
    </div>
  </div>
}

<main class="main-stage">
  @if (hasPayloadUrl && safePayloadUrl) {
    <div class="iframe-container" [class.loaded]="iframeLoaded">
      @if (!iframeLoaded) {
        <div class="iframe-loading">
          <div class="loading-spinner"></div>
          <span>Loading application...</span>
        </div>
      }
      <iframe
        #taskIframe
        class="task-iframe"
        [src]="safePayloadUrl"
        title="Task Content"
        sandbox="allow-same-origin allow-scripts allow-forms allow-popups allow-popups-to-escape-sandbox"
        (load)="onIframeLoad()"
        (error)="onIframeError()"
      ></iframe>
    </div>
  } @else {
    <div class="empty-state">
      <div class="empty-state-content">
        <div class="empty-icon">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="64"
            height="64"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="1.5"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
            <line x1="3" y1="9" x2="21" y2="9"></line>
            <line x1="9" y1="21" x2="9" y2="9"></line>
          </svg>
        </div>
        <h2>No Task Loaded</h2>
        <p>Waiting for the next task assignment...</p>
      </div>
    </div>
  }
</main>

<aside class="workspace-sidebar">
  <!-- Agent Stats Panel -->
  <div class="sidebar-section stats-section">
    <app-agent-stats></app-agent-stats>
  </div>

  <div class="sidebar-header">
    <h2>Task Info</h2>
  </div>

  <div class="sidebar-content">
    @if (currentTask$ | async; as task) {
      <div class="task-details">
        <!-- Open Task URL Button -->
        @if (task.payloadUrl) {
          <div class="section task-url-section">
            <button class="open-url-btn" (click)="openTaskUrl(task.payloadUrl)">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
                <polyline points="15 3 21 3 21 9"></polyline>
                <line x1="10" y1="14" x2="21" y2="3"></line>
              </svg>
              Open Task in New Tab
            </button>
            <div class="url-display">
              <span class="field-label">Task URL</span>
              <span class="field-value url monospace">{{ task.payloadUrl }}</span>
            </div>
          </div>
        }

        <!-- Identity Section -->
        <div class="section">
          <div class="task-field">
            <span class="field-label">Task ID</span>
            <span class="field-value monospace">{{ task.id }}</span>
          </div>

          @if (task.externalId) {
            <div class="task-field">
              <span class="field-label">External ID</span>
              <span class="field-value monospace">{{ task.externalId }}</span>
            </div>
          }

          <div class="task-field">
            <span class="field-label">Work Type</span>
            <span class="field-value work-type-badge">{{ task.workType }}</span>
          </div>
        </div>

        <!-- Details Section -->
        <div class="section">
          <div class="task-field">
            <span class="field-label">Title</span>
            <span class="field-value">{{ task.title }}</span>
          </div>

          @if (task.description) {
            <div class="task-field">
              <span class="field-label">Description</span>
              <span class="field-value description">{{ task.description }}</span>
            </div>
          }
        </div>

        <!-- Priority & Status Section -->
        <div class="section">
          <div class="task-field-row">
            <div class="task-field half">
              <span class="field-label">Priority</span>
              <span class="field-value priority-badge" [attr.data-priority]="task.priority">
                {{ task.priority }}
              </span>
            </div>

            <div class="task-field half">
              <span class="field-label">Status</span>
              <span class="field-value status-badge" [attr.data-status]="task.status">
                {{ task.status }}
              </span>
            </div>
          </div>

          @if (task.queue) {
            <div class="task-field">
              <span class="field-label">Queue</span>
              <span class="field-value">{{ task.queue }}</span>
            </div>
          }
        </div>

        <!-- Timing Section -->
        @if (task.handleTime || task.createdAt) {
          <div class="section">
            <div class="section-title">Timing</div>

            @if (task.handleTime) {
              <div class="task-field">
                <span class="field-label">Handle Time</span>
                <span class="field-value time">{{ task.handleTime }}s</span>
              </div>
            }

            @if (task.createdAt) {
              <div class="task-field">
                <span class="field-label">Created</span>
                <span class="field-value time">{{ task.createdAt | date:'short' }}</span>
              </div>
            }
          </div>
        }

        <!-- Metadata Section -->
        @if (task.metadata && hasMetadata(task.metadata)) {
          <div class="section">
            <div class="section-title">Metadata</div>
            @for (item of getMetadataEntries(task.metadata); track item.key) {
              <div class="task-field">
                <span class="field-label">{{ item.key }}</span>
                <span class="field-value monospace">{{ item.value }}</span>
              </div>
            }
          </div>
        }
      </div>
    } @else {
      <div class="no-task">
        <p>No active task</p>
        <span class="no-task-hint">Click "Get Next Task" to receive work</span>
      </div>
    }
  </div>
</aside>
